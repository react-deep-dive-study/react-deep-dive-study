## 14 웹사이트 보안을 위한 리액트와 웹페이지 보안 이슈

### XSS

브라우저를 조작할 수 있는 코드가 페이지에 존재하여 로그인 세션이나 사용자의 데이터를 변경하는 등의 문제가 생김

- dangerouslySetInnerHTML props

innerHTML을 교체할 수 있는 props

넘겨받은 문자열을 DOM에 그대로 표시한다. 실행 가능한 코드가 포함된다면 해당 코드를 접근했을 때 동작하기에 주의해야 한다.

- useRef를 통한 삽입

useRef를 통해서 innerHtml을 변경가능하여 실행 가능한 코드가 포함되는 문제가 발생할 수 있다.

- React에서 XSS 문제를 피하는 방법

새니타이즈, 이스케이프 같은 형태로 안전한 HTML 코드만 삽입가능하게 해야한다.

사용자가 저장한 데이터를 안전한게 치환하는 작업이 필요한데, 서버에서 하는게 직접적인 요청등을 고려하기 때문에 좋다.

쿼리 스트링에 포함된 데이터라던지 여러 곳에서 데이터가 올 수 있기에 방어적으로 생각해야한다.

- JSX 데이터 바인딩

기본적으로 리액트는 XSS를 방어하기 때문에 dangerouslySetInnerHTML를 사용하지 않는다면 XSS가 발생하지 않는다.

### getServerSideProps, 서버 컴포넌트를 주의하자

- 서버 사이드에서 사용자 정보를 가진 쿠키를 브라우저에 내려주면 HTML에 노출되기에 보안적인 관점으로 좋지 않다.

### <a> 태그의 값에 적절한 제한을 둬야 한다

```tsx
<a href="javascript: ;">링크</a>
```

href에 자바스크립트 코드가 있다면 유저가 클릭했을 때 실행되기에 주의해야한다. 또한 시멘틱적으로도 좋지않기에 피하자.

만약 href를 사용자로 부터 받아야한다면 origin을 제한하자.

### HTTP 보안 헤더 설정하기

- Strict-Transport-Security

응답 헤더로 모든 요청이 HTTPS로 와야 함을 알린다.

- X-XSS-Protection

비표준으로 사파리와 구형 브라우저에서 제공하며 XSS 취약점이 발견되면 페이지 로딩을 중단한다.

Content-Security-Policy가 있다면 그다지 필요 없지만 구형 브라우저를 위해 사용이 가능하다.

- X-Frame-Option

외부 페이지에서 자신의 페이지를 iframe, frame, embed, object 내부에서 렌더링을 허용할지 나타낼 수 있다.

- Permissions-Policy

카메라, 위치 기능등 허용가능한 기능을 명시하여 XSS로 허용하지 않은 기능이 실행되는 것을 막을 수 있다.

- X-Content-Type-Options

MIME 타입을 임의로 파악해서 파싱, 실행시키지 않게한다. 만약 공격자가 jpg 파일을 실행가능한 자바스크립트 파일로 올렸다면 브라우저가 임의로 자바스크립트 스크립트로 판단하여 실행시킬 수 있지만 이러한 과정을 막는다.

- Referrer-Policy

Referer가 노출되는 것을 막기 위해 범위를 설정한다. strict-origin-when-cross-origin이 일반적으로 많이 사용된다.

- Content-Security-Policy

XSS나 데이터 삽입 공격등을 막기위해 설계되었다.

특정 url에서만 리소스를 받을 수 있게 설정할 수 있다.

### 보안 헤더 설정하기

next.js는 next.config.js에서 보안 헤더를 설정할 수 있다.

## 15 마치며

- 리액트 최소 버전을 16.8.6에서 17.0.2 까지 올리자. 훅을 사용할 수 있게하자.

- 서버 사이드 렌더링을 고려하여 퍼포먼스를 염두하자.

- 상태 관리 라이브러리는 꼭 필요할 때만 사용하자.

### 리액트도 언젠가 사라질 수 있다

- 리액트만의 특성이 있기 때문에 입문하기에 좋지 않을 수도 있다.
